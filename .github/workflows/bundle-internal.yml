name: 內部資源更新

on:
  workflow_dispatch:
    inputs:
      environment:
        description: '環境'
        required: true
        default: 'development'
        type: choice
        options:
          - development
          - test
          - production

      build_windows:
        description: '打包Windows環境'
        required: true
        default: true
        type: boolean

      build_android:
        description: '打包Android環境'
        required: true
        default: true
        type: boolean

      build_ios:
        description: '打包iOS環境'
        required: true
        default: true
        type: boolean

jobs:
  summary_inputs:
    steps:
      - name: Summary Inputs
        uses: ./.github/actions/summary-inputs
        with:
          all_inputs: ${{ toJSON(inputs) }} 

  build_windows:
    if: ${{ inputs.build_windows }}
    runs-on: [self-hosted]

    steps:
      - name: check out
        uses: actions/checkout@v4
        with:
          submodules: recursive
          lfs: true
          clean: false

      - name: Install Packages
        uses: ./.github/actions/install-packages

      - name: Build Bundle(Windows)
        uses: ./.github/actions/update-bundles
        with:
          git_token: ${{ github.token }} 
          force_clean: false
          environment: ${{ inputs.environment }}
          platform: windows
          dev_mode: true
          auto_compile: false

  build_ios:
    if: ${{ inputs.build_ios }}
    runs-on: [self-hosted]

    steps:
      - name: check out
        uses: actions/checkout@v4
        with:
          submodules: recursive
          lfs: true
          clean: false

      - name: Install Packages
        uses: ./.github/actions/install-packages

      - name: Build Bundle(iOS)
        uses: ./.github/actions/update-bundles
        with:
          git_token: ${{ github.token }} 
          force_clean: false
          environment: ${{ inputs.environment }}
          platform: ios
          dev_mode: true
          auto_compile: false

  build_android:
    if: ${{ inputs.build_android }}
    runs-on: [self-hosted]

    steps:
      - name: check out
        uses: actions/checkout@v4
        with:
          submodules: recursive
          lfs: true
          clean: false

      - name: Install Packages
        uses: ./.github/actions/install-packages

      - name: Build Bundle(Android)
        uses: ./.github/actions/update-bundles
        with:
          git_token: ${{ github.token }} 
          force_clean: false
          environment: ${{ inputs.environment }}
          platform: android
          dev_mode: true
          auto_compile: false