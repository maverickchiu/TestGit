name: å…§éƒ¨è³‡æºæ›´æ–°

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'ç’°å¢ƒ'
        required: true
        default: 'development'
        type: choice
        options:
          - development
          - test
          - production
      version_name:
        description: 'ç‰ˆæœ¬åç¨±'
        required: true
        default: '1.2.12'
        type: choice
        options:
          - 1.2.12
          - 1.66.1
          - 1.66.2
          - 1.66.3
          - 1.66.4
          - 1.66.5
          - 1.66.6
          - 1.66.7
      build_windows:
        description: 'æ‰“åŒ…Windowsç’°å¢ƒ'
        required: true
        default: true
        type: boolean
      build_android:
        description: 'æ‰“åŒ…Androidç’°å¢ƒ'
        required: true
        default: true
        type: boolean
      build_ios:
        description: 'æ‰“åŒ…iOSç’°å¢ƒ'
        required: true
        default: true
        type: boolean

# é˜²æ­¢å¤šå€‹æ‰“åŒ…ä»»å‹™åŒæ™‚åœ¨åŒä¸€å€‹ Runner ä¸Šæ‰“æ¶
concurrency:
  group: cocos-bundle-update-${{ github.ref }}
  cancel-in-progress: false

jobs:
  # ğŸ’¡ ç¾åœ¨é€™å€‹å…¥å£ Job åªéœ€è¦ã€Œå‘¼å«ã€å‰¯ç¨‹å¼
  call_build_bundle:
    uses: ./.github/workflows/build_bundle.yml # æŒ‡å‘ä½ çš„å‰¯ç¨‹å¼æª”æ¡ˆ
    with:
      environment: ${{ inputs.environment }}
      version_name: ${{ inputs.version_name }}
      build_windows: ${{ inputs.build_windows }}
      build_android: ${{ inputs.build_android }}
      build_ios: ${{ inputs.build_ios }}
      dev_mode: true        # é€™è£¡å¯ä»¥å¯«æ­»æˆ–ä¹Ÿæ”¹æˆ input
      auto_compile: false   # å…§éƒ¨æ›´æ–°é€šå¸¸ä¸ç·¨è­¯åŸ·è¡Œæª”

  # ğŸ’¡ å¦‚æœä½ ä¹‹å¾Œéœ€è¦æ‹¿é‚£å€‹ Build Number åšå¾ŒçºŒè™•ç†ï¼Œå¯ä»¥åŠ é€™ä¸€æ­¥
  after_build:
    needs: call_build_bundle
    runs-on: [self-hosted]
    steps:
      - name: é¡¯ç¤ºæœ€çµ‚è™Ÿç¢¼
        run: echo "å‰›å‰›å®Œæˆçš„æ‰“åŒ…åºè™Ÿæ˜¯ï¼š${{ needs.call_build_bundle.outputs.final_build_number }}"