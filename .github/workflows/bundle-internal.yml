name: å…§éƒ¨è³‡æºæ›´æ–°

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'ç’°å¢ƒ'
        required: true
        default: 'development'
        type: choice
        options:
          - development
          - test
          - production
      version_name:
        description: 'ç‰ˆæœ¬åç¨±'
        required: true
        default: '1.2.12'
        type: choice
        options:
          - 1.2.12
          - 1.66.1
          - 1.66.2
          - 1.66.3
          - 1.66.4
          - 1.66.5
          - 1.66.6
          - 1.66.7
      build_windows:
        description: 'æ‰“åŒ…Windowsç’°å¢ƒ'
        required: true
        default: true
        type: boolean
      build_android:
        description: 'æ‰“åŒ…Androidç’°å¢ƒ'
        required: true
        default: true
        type: boolean
      build_ios:
        description: 'æ‰“åŒ…iOSç’°å¢ƒ'
        required: true
        default: true
        type: boolean

# é˜²æ­¢å¤šå€‹æ‰“åŒ…ä»»å‹™åŒæ™‚åœ¨åŒä¸€å€‹ Runner ä¸Šæ‰“æ¶
concurrency:
  group: cocos-bundle-update-${{ github.ref }}
  cancel-in-progress: false

jobs:
  # ğŸ’¡ ç¾åœ¨é€™å€‹å…¥å£ Job åªéœ€è¦ã€Œå‘¼å«ã€å‰¯ç¨‹å¼
  call_build_bundle:
    uses: ./.github/workflows/build-bundle.yml 
    with:
      environment: ${{ inputs.environment }}
      version_name: ${{ inputs.version_name }}
      build_windows: ${{ inputs.build_windows }}
      build_android: ${{ inputs.build_android }}
      build_ios: ${{ inputs.build_ios }}
      dev_mode: true        # é€™è£¡å¯ä»¥å¯«æ­»æˆ–ä¹Ÿæ”¹æˆ input
      auto_compile: false   # å…§éƒ¨æ›´æ–°é€šå¸¸ä¸ç·¨è­¯åŸ·è¡Œæª”

  after_build:
    needs: call_build_bundle
    if: always() # ç¢ºä¿å³ä¾¿å¤±æ•—ä¹Ÿé¡¯ç¤ºä¸€ä¸‹
    runs-on: [self-hosted]
    steps:
      - name: Show Final Build Number
        shell: bash # ğŸ’¡ å¼·åˆ¶ä½¿ç”¨ bash é¿å… PowerShell äº‚ç¢¼
        run: |
          echo "Build Process Completed."
          echo "Final Build Number is: ${{ needs.call_build_bundle.outputs.final_build_number }}"