name: å…§éƒ¨å»ºç½®å·¥å…·

run-name: ğŸš€ [${{ inputs.environment }}] ç‰ˆæœ¬:${{ inputs.version_name }} ç”± @${{ github.actor }} è§¸ç™¼

on:
  workflow_dispatch:
    inputs:
      platform:
        description: 'å¹³å°'
        required: true
        default: 'windows'
        type: choice
        options:
          - windows
          - android
          - ios

      environment:
        description: 'ç’°å¢ƒ'
        required: true
        default: 'development'
        type: choice
        options:
          - development
          - test
          - production

      version_name:
        description: 'ç‰ˆæœ¬åç¨±'
        required: true
        default: '1.2.12'
        type: choice
        options:
          - 1.2.12
          - 1.66.1
          - 1.66.2
          - 1.66.3
          - 1.66.4
          - 1.66.5
          - 1.66.6
          - 1.66.7
jobs:
  build:
    runs-on: [self-hosted]

    steps:
      - name: check out
        uses: actions/checkout@v4
        with:
          submodules: recursive
          lfs: true
          clean: false

      - name: Summary Inputs
        uses: ./.github/actions/summary-inputs
        with:
          all_inputs: ${{ toJSON(inputs) }} 

      - name: Install Packages
        uses: ./.github/actions/install-packages

      - name: Build Bundle & Compile
        uses: ./.github/actions/build-core
        with:
          git_token: ${{ github.token }} 
          force_clean: false
          environment: ${{ inputs.environment }}
          platform: ${{ inputs.platform }}
          dev_mode: true
          auto_compile: true
          version_name: ${{ inputs.version_name }}

      # - name: Upload Bundle
      #   uses: ./.github/actions/upload-bundles
      #   with:
      #     environment: ${{ inputs.environment }}
      #     platform: ${{ inputs.platform }}
      #     dev_mode: true
      #     version_name: ${{ inputs.version_name }}

      - name: Upload Release
        uses: ./.github/actions/upload-release
        with:
          environment: ${{ inputs.environment }}
          platform: ${{ inputs.platform }}
          dev_mode: true
          version_name: ${{ inputs.version_name }}
          signing_type: 'debug'
          bundle_code: ''